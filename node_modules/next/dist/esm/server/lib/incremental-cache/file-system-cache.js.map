{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","CACHE_ONE_YEAR","memoryCache","tagsManifest","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","maxMemoryCacheSize","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","join","loadTagsManifest","parse","readFileSync","toString","err","version","items","setTags","key","tags","tag","keys","includes","push","mkdir","dirname","writeFile","console","warn","revalidateTag","revalidatedAt","Date","now","get","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","isAppPath","parsedData","set","innerData","isStale","some","htmlPath"],"mappings":"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"}