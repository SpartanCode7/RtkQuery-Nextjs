{"version":3,"sources":["../../src/server/web-server.ts"],"names":["NextWebServer","BaseServer","constructor","options","Object","assign","renderOpts","webServerConfig","extendRenderOpts","handleCompression","getIncrementalCache","requestHeaders","dev","IncrementalCache","requestProtocol","appDir","hasAppDir","allowedRevalidateHeaderKeys","nextConfig","experimental","minimalMode","fetchCache","fetchCacheKeyPrefix","maxMemoryCacheSize","isrMemoryCacheSize","flushToDisk","CurCacheHandler","serverOptions","incrementalCacheHandler","getPrerenderManifest","version","routes","dynamicRoutes","notFoundRoutes","preview","previewModeId","getResponseCache","WebResponseCache","getCustomRoutes","headers","rewrites","fallback","afterFiles","beforeFiles","redirects","run","req","res","parsedUrl","hasPage","page","getPublicDir","getBuildId","buildId","loadEnvConfig","getHasAppDir","pagesType","getHasStaticDir","getFallback","getFontManifest","undefined","getPagesManifest","getAppPathsManifest","getFilesystemPaths","Set","attachRequestMeta","addRequestMeta","query","previewModeSigningKey","previewModeEncryptionKey","getServerComponentManifest","clientReferenceManifest","getServerCSSManifest","serverCSSManifest","getNextFontManifest","nextFontManifest","generateRoutes","fsRoutes","match","getPathMatch","type","name","check","fn","params","_parsedUrl","path","render404","finished","shift","lastParam","length","endsWith","pathname","join","getRouteFromAssetPath","router","hasMiddleware","trailingSlash","substring","i18n","host","hostname","split","toLowerCase","localePathResult","normalizeLocalePath","locales","domainLocale","i18nProvider","detectDomainLocale","detectedLocale","__nextLocale","__nextDefaultLocale","defaultLocale","__nextDataReq","_params","catchAllRoute","matchesLocale","Error","isDynamicRoute","routeRegex","getNamedRouteRegex","interpolateDynamicPath","normalizeVercelUrl","keys","routeKeys","removeTrailingSlash","analyze","bubbleNoFallback","_nextBubbleNoFallback","isAPIRoute","render","err","NoFallbackError","useFileSystemPublicRoutes","appPathRoutes","getAppPathRoutes","catchAllMiddleware","matchers","handleApiRequest","renderHTML","_res","pagesRenderToHTML","appRenderToHTML","curRenderToHTML","url","method","cookies","body","disableOptimizedLoading","runtime","sendRenderResult","_req","setHeader","poweredByHeader","resultContentType","result","contentType","getHeader","isDynamic","writer","transformStream","writable","getWriter","pipe","write","chunk","end","close","destroy","abort","cork","uncork","payload","toUnchunkedString","String","byteLength","generateEtags","generateETag","send","runApi","findPageComponents","loadComponent","components"],"mappings":"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"}